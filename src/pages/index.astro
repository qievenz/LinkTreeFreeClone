---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Link from "../components/Link.astro";
import Footer from "../components/Footer.astro";
import Contact from "../components/Contact.astro";

import { 
    SUBTITLE, 
    TITLE, 
    TAGLINE,
    contact,
    phone,
    email
} from "../config";

// fetch all Markdown files in the links directory
const links = await Astro.glob("./links/*.md");
---

<Layout title={TITLE + " - " + SUBTITLE}>
	
    <Header subtitle={SUBTITLE} title={TITLE} tagline={TAGLINE} />

    <section class="mb-8">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <h2 class="text-center text-2xl font-bold mb-4 text-secondary-heading">Support</h2>
            <div class="mx-auto max-w-3xl">
                <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 items-center">
                    {
                        (() => {
                            const filteredLinks = links.filter(link => [3, 5, 7].includes(link.frontmatter.block));
                            return filteredLinks.map((link, index) => {
                                const isLastOnSm = (index === filteredLinks.length - 1) && (filteredLinks.length % 2 !== 0);
                                const wrapperClass = isLastOnSm ? "sm:col-span-2" : "";

                                if (link.frontmatter.block === 3) { // Cafecito
                                    const cafecitoHTML = `<a href='https://cafecito.app/qievenz' rel='noopener' target='_blank'><img style="transform: scale(1.3);" srcset='https://cdn.cafecito.app/imgs/buttons/button_4.png 1x, https://cdn.cafecito.app/imgs/buttons/button_4_2x.png 2x, https://cdn.cafecito.app/imgs/buttons/button_4_3.75x.png 3.75x' src='https://cdn.cafecito.app/imgs/buttons/button_4.png' alt='Invitame un cafÃ© en cafecito.app' /></a>`;
                                    return <div class:list={[wrapperClass, "flex justify-center"]} set:html={cafecitoHTML} />;
                                }

                                return (
                                    <div class={wrapperClass}>
                                        <Link
                                            emoji={link.frontmatter.emoji}
                                            title={link.frontmatter.title}
                                            href={link.frontmatter.href}
                                            iconSrc={link.frontmatter.iconSrc}
                                            isBanner={link.frontmatter.isBanner}
                                        />
                                    </div>
                                )
                            })
                        })()
                    }
                </div>
            </div>
        </div>
    </section>

    <section>
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <h2 class="text-center text-2xl font-bold mb-4 text-secondary-heading">CV</h2>
            <div class="mx-auto max-w-3xl">
                <div class="grid grid-cols-1 gap-4">
                    <Link
                        emoji="ðŸ“„"
                        title="Download CV"
                        href="/CV.pdf"
                    />
                </div>
            </div>
        </div>
    </section>

    <Contact
        contact={contact}
        phone={phone}
        email={email}
    />

	<Footer
		title={TITLE}
		tagline={TAGLINE}
	/>

</Layout>
